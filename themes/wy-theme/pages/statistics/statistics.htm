title = '统计'
url = '/statistics'
layout = 'default'

[b7Statistics]
==
function onStart(){
$this->addJs('https://cdn.bootcss.com/Chart.js/2.5.0/Chart.bundle.min.js');
}
==

<div class="jumbotron">
    <div class="container">
        <h2>数据统计</h2>
    </div>
</div>
<div class="container m-t">
  <div class="row">
    {% for post in statistics %}
    <div class="col-md-6">
            <div class="box box-default">
                <div class="box-header with-border">
                    <h3 class="box-title">{{ post.title }}</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i>
                        </button>
                    </div>
                    <!-- /.box-tools -->
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <div class="chart">
                        <canvas id="line-chart-{{ loop.index }}"></canvas>
                    </div>
                </div>
                <!-- /.box-body -->
            </div>
        </div>
    {% endfor %}
  </div>
    
  <div class="row">
    {% for post in statistics %}
    <div class="col-md-6">
            <div class="box box-default">
                <div class="box-header with-border">
                    <h3 class="box-title">{{ post.title }}</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i>
                        </button>
                    </div>
                    <!-- /.box-tools -->
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <div class="chart">
                        <canvas id="pie-chart-{{ loop.index }}"></canvas>
                    </div>
                </div>
                <!-- /.box-body -->
            </div>
        </div>
    {% endfor %}
  </div>
</div>

{% put scripts %}
<script>
  {% for post in statistics %}
    // line chart
    var ctxLineChart = document.getElementById('line-chart-{{ loop.index }}');
    var lineChartData = {
        labels: [{% for item in post.detail %}"{{ item.name }}",{% endfor %}],
        datasets: [
            {
                label: "{{ post.title }}",
                fill: false,
                lineTension: 0.1,
                backgroundColor: "rgba(75,192,192,0.4)",
                borderColor: "rgba(75,192,192,1)",
                borderCapStyle: 'butt',
                borderDash: [],
                borderDashOffset: 0.0,
                borderJoinStyle: 'miter',
                pointBorderColor: "rgba(75,192,192,1)",
                pointBackgroundColor: "#fff",
                pointBorderWidth: 1,
                pointHoverRadius: 5,
                pointHoverBackgroundColor: "rgba(75,192,192,1)",
                pointHoverBorderColor: "rgba(220,220,220,1)",
                pointHoverBorderWidth: 2,
                pointRadius: 1,
                pointHitRadius: 10,
                data: [{% for item in post.detail%}{{ item.price*item.quantity }},{% endfor %}],
                spanGaps: false,
            }
        ]
    };
    var lineChartOptions = {};
    var lineChart = new Chart(ctxLineChart, {
        type: 'line',
        data: lineChartData,
        options: lineChartOptions
    });
   {% endfor %}
   
   {% for post in statistics %}
   // pie chart
    var ctxPieChart = document.getElementById('pie-chart-{{loop.index}}');
    var pieChartDate = {
        datasets: [{
            data: [{% for item in post.detail%}{{ item.price*item.quantity }},{% endfor %}],
            backgroundColor: ["#3c8dbc", "#dd4b39", "#00a65a", "#00c0ef", "#f39c12", "#0073b7","#005875"],
            label: 'My dataset' // for legend
        }],
        labels: [{% for item in post.detail %}"{{ item.name }}",{% endfor %}],
    };
    var pieChart = new Chart(ctxPieChart, {
        type: 'pie',
        data: pieChartDate
    });
    {% endfor %}
</script>
{% endput %}
